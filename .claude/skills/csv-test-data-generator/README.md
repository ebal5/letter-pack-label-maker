# CSV Test Data Generator - 使用ガイド

レターパックラベル生成機能のテスト用CSVデータを自動生成するSkillです。手動でテストデータを作成する手間を削減し、多様なエッジケースをカバーしたテストを効率化します。

## 概要

このSkillは、以下の4つのデータパターンをサポートしています：

| パターン | 用途 | 特徴 |
|---------|------|------|
| **標準** | デフォルトテスト | リアルなデータ、指定件数生成可 |
| **エッジケース** | 境界値テスト | 長い住所、特殊文字、異なる敬称 |
| **ストレステスト** | パフォーマンス検証 | 大量データ、1000件以上対応 |
| **不正データ** | エラーハンドリング検証 | 形式エラー、欠落フィールド |

## インストール

このSkillは既に`.claude/skills/csv-test-data-generator/`に格納されています。

## クイックスタート

### 1. 標準パターンで10件生成

```bash
python tools/generate_test_csv.py
```

**出力ファイル：** `examples/test_addresses_standard_10.csv`

### 2. 指定件数の標準データを生成

```bash
# 100件生成
python tools/generate_test_csv.py standard 100

# 1000件生成
python tools/generate_test_csv.py standard 1000
```

### 3. エッジケースデータを生成

```bash
python tools/generate_test_csv.py edge_case
```

**特性：**
- 長い住所、短い住所
- 様々な敬称（様、殿、御中、各位、なし）
- 特殊な郵便番号（000-0000、999-9999）
- 長い会社名、団体名

### 4. ストレステスト用データ生成

```bash
python tools/generate_test_csv.py stress 5000
```

**特性：**
- 大量のランダムデータ
- メモリ効率的
- 10000件以上も対応

### 5. 不正データを生成

```bash
python tools/generate_test_csv.py invalid
```

**特性：**
- 郵便番号形式エラー
- 必須フィールド欠落
- 不正な文字列
- バリデーション検証に最適

## 生成されるCSV形式

生成されるCSVファイルは、以下のカラムを含みます：

```csv
宛先郵便番号,宛先都道府県,宛先市区町村,宛先番地,宛先建物名,宛先名前,宛先敬称,差出人郵便番号,差出人都道府県,差出人市区町村,差出人番地,差出人建物名,差出人名前,差出人敬称
```

**各フィールドの説明：**

| フィールド | 説明 | 例 |
|-----------|------|-----|
| 宛先郵便番号 | 宛先の郵便番号（XXX-XXXX形式） | 100-0001 |
| 宛先都道府県 | 宛先の都道府県 | 東京都 |
| 宛先市区町村 | 宛先の市区町村 | 千代田区 |
| 宛先番地 | 宛先の番地 | 千代田1-1 |
| 宛先建物名 | 宛先の建物名（オプション） | ABCビル5F |
| 宛先名前 | 宛先の名前 | 山田太郎 |
| 宛先敬称 | 敬称（様、殿、なし） | 様 |
| 差出人郵便番号 | 差出人の郵便番号 | 150-0001 |
| 差出人都道府県 | 差出人の都道府県 | 東京都 |
| 差出人市区町村 | 差出人の市区町村 | 渋谷区 |
| 差出人番地 | 差出人の番地 | 渋谷1-1 |
| 差出人建物名 | 差出人の建物名（オプション） | |
| 差出人名前 | 差出人の名前 | 佐藤花子 |
| 差出人敬称 | 敬称（様、なし） | |

## 実装詳細

### 標準パターン

リアルなテストデータを生成します：

- **都道府県：** 全47都道府県から選択
- **市区町村：** 40+の主要市区町村から選択
- **名前：** 40+の一般的な日本人名から選択
- **敬称：** 様、殿、なし（ランダム）
- **郵便番号：** XXX-XXXX形式で正確に生成
- **建物名：** ABCビル、XYZビルなど（オプション）

### エッジケースパターン

境界値テスト用の特殊なデータを事前に定義しています：

1. **長い住所**
   - 市区町村：最大限の文字数
   - 番地：複数の数字で構成
   - 建物名：長い名称

2. **短い住所**
   - 最小限の情報（市区町村、番地のみ）
   - 建物名なし

3. **特殊な敬称**
   - 様（標準）
   - 殿（フォーマル）
   - 御中（組織向け）
   - 各位（複数宛先向け）
   - なし（敬称なし）

4. **境界郵便番号**
   - 000-0000（最小値）
   - 999-9999（最大値）

5. **長い名前**
   - 会社名や団体名を想定

### ストレステストパターン

大量データを高速に生成します：

- ランダムな組み合わせで毎回異なるデータを生成
- メモリ効率的な実装
- 1000件、5000件、10000件などの大規模テストに対応
- 4upレイアウト時のページ数自動計算

### 不正データパターン

バリデーション検証用の不正なデータを事前に定義しています：

1. **郵便番号形式エラー**
   - 形式が異なる（XXXX-XXX など）
   - 数字以外を含む

2. **必須フィールド欠落**
   - 都道府県なし
   - 名前なし
   - 郵便番号なし

3. **不正な文字列**
   - 制御文字を含む
   - 不正な文字コード

4. **空行・空白のみの行**
   - 完全に空のレコード
   - 空白のみのレコード

## 出力例

### 標準パターン（10件）の出力

```
✅ テストCSVデータを生成しました

【ファイル】
- パス: examples/test_addresses_standard_10.csv
- 件数: 10件
- パターン: 標準
- 推定ページ数: 3ページ（4upレイアウト）

【内容サマリー】
- 宛先敬称分布: 様(6), 殿(2), なし(2)
- 差出人敬称分布: 様(1), なし(9)
- 都道府県: 東京都, 大阪府, 北海道など
- 郵便番号: すべて正しい形式(XXX-XXXX)

【次のステップ】
以下のコマンドでラベルを生成できます：
uv run python -m letterpack.cli --csv examples/test_addresses_standard_10.csv --output output/test_labels.pdf
```

### ストレステスト（5000件）の出力

```
✅ テストCSVデータを生成しました

【ファイル】
- パス: examples/test_addresses_stress_5000.csv
- 件数: 5000件
- パターン: ストレステスト
- 推定ページ数: 1250ページ（4upレイアウト）
- 生成時間: 2.3秒

【内容サマリー】
- 宛先敬称分布: 様(1667), 殿(1667), なし(1666)
- 都道府県: 全47都道府県網羅
- 郵便番号: 4217パターン（すべて正しい形式）

【注意】
大量データのため、ラベル生成は時間がかかる場合があります。
```

## よくある質問（FAQ）

### Q1: 生成されたCSVファイルはどこに保存されますか？

**A:** `examples/`ディレクトリに保存されます。ファイル名はパターンと件数に基づいて自動生成されます。

- 標準パターン：`test_addresses_standard_10.csv`
- エッジケース：`test_addresses_edge_case.csv`
- ストレステスト：`test_addresses_stress_5000.csv`
- 不正データ：`test_addresses_invalid.csv`

### Q2: 生成されたデータは実際の個人情報ですか？

**A:** いいえ。すべてのデータは完全にランダムに生成された架空のデータです。実在する個人や組織の情報は含まれていません。テスト用途のみに安全に使用できます。

### Q3: 特定のデータを含むCSVを生成したいのですが？

**A:** 現在のSkillはランダムデータ生成に特化しています。特定のデータが必要な場合は、生成されたCSVをテキストエディタで編集して、必要な行を追加・変更してください。

### Q4: 郵便番号の形式を変更できますか？

**A:** 現在のSkillは標準的なXXX-XXXX形式で固定です。他の形式が必要な場合は、`tools/generate_test_csv.py`を編集して`generate_postal_code()`関数を変更してください。

### Q5: 生成速度が遅い場合はどうしますか？

**A:** 大量データ（10000件以上）の生成時は、以下の対策を検討してください：

1. **件数を減らす**：最初は1000件で試す
2. **別のPythonプロセス**：バックグラウンドで実行
3. **ファイル最適化**：圧縮ファイル形式の使用（ただし現在は未実装）

### Q6: 複数のパターンを組み合わせたデータを生成できますか？

**A:** 現在のSkillは単一パターンのみに対応しています。複数パターンを組み合わせる場合は、各パターンで生成後、CSVファイルを手動でマージしてください。

## トラブルシューティング

### エラー: `No such file or directory: tools/generate_test_csv.py`

**原因：** プロジェクトルートから実行していない

**解決方法：** プロジェクトルートディレクトリで実行してください

```bash
cd /path/to/letter-pack-label-maker
python tools/generate_test_csv.py
```

### エラー: `ModuleNotFoundError: No module named 'letterpack'`

**原因：** 依存関係がインストールされていない

**解決方法：** 依存関係をインストール

```bash
uv sync --all-extras
```

### エラー: `examples/`ディレクトリが存在しない

**原因：** examplesディレクトリが未作成

**解決方法：** ディレクトリを作成してから実行

```bash
mkdir -p examples
python tools/generate_test_csv.py
```

### 生成されたCSVファイルが文字化けしている

**原因：** テキストエディタのエンコーディング設定が異なる

**解決方法：** UTF-8エンコーディングで開く

## 関連リソース

- `src/letterpack/csv_parser.py` - CSV解析ロジック
- `src/letterpack/label.py` - ラベルデータモデル
- `tests/test_csv_parser.py` - CSVパーサーのテスト
- `README.md` - プロジェクト全体の使用方法

## 実装スクリプト

データ生成ロジックは`tools/generate_test_csv.py`に実装されています。

### スクリプト構造

```python
# 利用可能な関数

generate_postal_code()
  → 郵便番号を生成（XXX-XXXX形式）

generate_address()
  → 住所データを生成（都道府県、市区町村、番地、建物名）

generate_name()
  → 日本人の名前を生成

generate_standard_data(count: int)
  → 標準パターンのデータを生成

generate_edge_case_data()
  → エッジケースのデータを生成

generate_stress_data(count: int)
  → ストレステスト用データを生成

generate_invalid_data()
  → 不正データを生成

save_csv(data: List[Dict], filename: str)
  → CSVファイルに保存
```

## カスタマイズ例

### 都道府県の限定

`tools/generate_test_csv.py`の`PREFECTURES`リストを編集して、特定の都道府県のみを使用することができます。

### 名前の追加

`tools/generate_test_csv.py`の`LAST_NAMES`と`FIRST_NAMES`リストを編集して、カスタム名前を追加できます。

## ライセンスと利用規約

このSkillで生成されるデータはテスト用途のみに使用してください。生成されたデータを実運用環境で使用することは推奨されていません。

## サポート

問題が発生した場合や機能要望がある場合は、GitHubのIssueで報告してください。
