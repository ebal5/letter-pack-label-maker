# Japanese Code Checker Skill - 使用ガイド

## 概要

このSkillは、日本語コード（コメント、ドキュメント、文字列リテラル）の品質を自動チェックするClaudeの拡張機能です。

## 主な機能

### 1. 文字コーディング検証 ✅
- すべてのテキストファイルがUTF-8エンコーディングか確認
- Shift_JIS、EUC-JPなどのレガシーエンコーディングを検出
- チェック対象：`.py`, `.md`, `.html`, `.csv`, `.yaml`, `.toml`, `.json`

### 2. 全角・半角統一チェック ⚠️
- 日本語文中の全角・半角の使い分けを検証
- 推奨ルール：
  - **数字**：半角（`123`）
  - **英字**：半角（`ABC`）
  - **記号**：半角（`()`）
  - **日本語句読点**：全角（`、。`）
  - **日本語括弧**：全角（`（）`）

### 3. コメント・ドキュメント品質チェック 📝
- 公開関数・クラスのdocstring有無確認
- 以下を検出：
  - docstringなし関数
  - docstringなしクラス
  - 複雑なロジックのコメント不足

## 使用方法

### 自動トリガー

このSkillは、ユーザーが以下のような依頼をした際に自動起動します：

```
「日本語のコメントをチェックして」
「ドキュメントの文体を統一して」
「文字コーディングを確認して」
「全角・半角が混在していないか確認して」
```

### 手動実行

ローカルでチェックスクリプトを実行することも可能です：

```bash
# プロジェクトルートで実行
python tools/check_japanese_code.py
```

## チェック結果の見方

### 出力例

```
============================================================
🔍 日本語コードチェックレポート
============================================================

【文字コーディング】
✅ すべてのファイルがUTF-8です

【全角・半角の使い分け】
⚠️ 3件の問題を検出

  src/letterpack/label.py:45
    - 問題: 全角数字
    - 現在: ７桁
    - 推奨: 7桁

【コメント・ドキュメント】
⚠️ 2件のdocstring不足を検出

  src/letterpack/label.py:120
    - 関数 _draw_postal_boxes: docstringがありません

【総合評価】
⚠️ 5件の改善点があります
  - 全角・半角: 3件（修正可能）
  - docstring: 2件（追加が必要）

============================================================
```

### 記号の説明

- ✅ **合格** - 問題なし
- ⚠️ **警告** - 改善推奨
- ❌ **エラー** - 対応が必要

## チェック項目の詳細

### 全角・半角チェックの例

✅ 推奨例：
```python
# 郵便番号は7桁です
# PDF形式で出力します
address = "東京都渋谷区1-1-1"
```

❌ 非推奨例：
```python
# 郵便番号は７桁です（全角数字）
# ＰＤＦ形式で出力します（全角英字）
address = "東京都渋谷区１-１-１"（全角数字）
```

### docstring チェックの例

✅ 推奨例：
```python
class LabelGenerator:
    """ラベルを生成するクラス"""

    def generate(self, data):
        """指定されたデータからラベルを生成

        Args:
            data: ラベルデータ

        Returns:
            生成されたPDFバイナリ
        """
        pass
```

❌ 非推奨例：
```python
class LabelGenerator:
    # docstringなし

    def generate(self, data):
        # docstringなし
        pass
```

## 設定のカスタマイズ

### チェック除外ファイル

スクリプトは以下のディレクトリを自動的に除外します：
- `.git/`
- `node_modules/`
- `.venv/`
- `__pycache__/`

追加の除外パターンが必要な場合は、`tools/check_japanese_code.py`の`main()`関数内の除外ロジックを修正してください。

### 推奨ルールの変更

各チェック関数のパターンを修正することで、推奨ルールをカスタマイズできます：

```python
# 例：全角数字パターンを変更
fullwidth_pattern = re.compile(r"[０-９]+")  # ← ここを修正
```

## トラブルシューティング

### 「全角・半角チェックで誤検出が多い」

**原因**：正規表現がコード例や特殊な文脈を区別していない

**対策**：チェック対象を制限するか、スクリプトを修正してください

```python
# コード例ブロック（```...```）内は除外する
def check_fullwidth_numbers(text, file_path, line_num):
    # バックティック内のテキストをスキップ
    if "```" in text or "`" in text:
        return []
    # ... 以降のチェック
```

### 「docstringチェックで関数が検出されない」

**原因**：正規表現がすべての関数定義パターンに対応していない

**対策**：正規表現パターンを拡張してください

```python
# デコレータ付き関数にも対応
function_pattern = re.compile(
    r"(?:@\w+\s*)*^def\s+(\w+)\s*\(",
    re.MULTILINE
)
```

## パフォーマンス

- **チェック対象ファイル数**：プロジェクト内のすべての`.py`, `.md`, `.html`ファイル
- **実行時間**：通常 1～3秒
- **メモリ使用量**：最小限（ファイル単位で処理）

## 今後の拡張計画

### Phase 2 (将来)
- [ ] 文体の統一性チェック（「です・ます」調の一貫性）
- [ ] 用語の統一チェック（「ラベル」vs「レーベル」）
- [ ] より詳細な敬語チェック

### Phase 3 (将来)
- [ ] 自動修正機能（全角・半角の自動変換）
- [ ] docstringテンプレートの自動挿入
- [ ] 用語の自動置換

## 参考資料

- [PEP 263 - Defining Python Source Code Encodings](https://www.python.org/dev/peps/pep-0263/)
- [PEP 257 - Docstring Conventions](https://www.python.org/dev/peps/pep-0257/)
- [日本語スタイルガイド](https://www.bunka.go.jp/)

## 関連ドキュメント

- `CLAUDE.md` - プロジェクト全体のClaudeガイド
- `AGENTS.md` - AI エージェント向けガイドライン

## サポート

質問や問題がある場合は、GitHub Issuesにお知らせください。
