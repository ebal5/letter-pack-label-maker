# PDF Validation Skill - 使用方法

## 概要

このSkillは、生成されたレターパックラベルPDFを自動検証し、品質保証を支援するClaude Code Skillです。

## Skillの起動方法

Claude Codeに以下のような指示をすると自動的にこのSkillが起動します：

- 「PDFを検証して」
- 「生成されたPDFの内容を確認してください」
- 「PDFの品質チェックをお願い」
- 「出力されたラベルを検証して」

## 検証される項目

### 基本情報
- ✅ ページサイズ（A4: 210mm × 297mm）
- ✅ ページ数の確認
- ✅ PDFバージョンの確認
- ✅ ファイルの完全性

### フォント情報
- ✅ 使用されているフォント名
- ✅ フォント埋め込み状態（重要）
- ✅ 日本語フォントの確認
- ✅ 文字エンコーディング

### テキスト内容（レターパック）
- ✅ 郵便番号の形式確認（XXX-XXXX）
- ✅ 住所フィールドの存在確認
- ✅ 受取人名の確認
- ✅ 差出人情報の確認
- ✅ テキスト内容の正確性

### レイアウト検証
- ✅ マージンの確認
- ✅ テキスト要素の配置確認
- ✅ フォントサイズの確認
- ✅ 要素の重複確認

## 検証結果の見方

検証完了後、以下のようなレポートが出力されます：

```
✅ PDF検証結果

【基本情報】
- ファイル: output/label_20241113.pdf
- ページサイズ: 210mm × 297mm (A4) ✅
- ページ数: 1 ✅
- PDFバージョン: 1.4 ✅

【フォント】
- IPAGothic: 埋め込み済み ✅
- Helvetica: 標準フォント ✅

【テキスト内容】
- 郵便番号: 100-0001 ✅
- 住所: 東京都千代田区千代田1-1 ✅
- 名前: 山田太郎 様 ✅

【問題点】
なし

【警告】
- （問題がある場合はここに表示）

【総合評価】
✅ すべての検証項目をパスしました。
```

## 問題が見つかった場合

検証結果に問題が見つかった場合、以下の情報が提供されます：

- **問題の内容**: 何が問題なのか
- **原因**: なぜそれが問題なのか
- **修正案**: どう修正すればよいか
- **参考資料**: 関連するドキュメントへのリンク

## 使用例

### 例1: 基本的な検証

```
ユーザー: 「PDFを検証して」

Claude: (スクリプトを実行)
✅ PDF検証結果
【基本情報】
- ページサイズ: 210mm × 297mm (A4) ✅
...
```

### 例2: 複数ページPDFの検証

```
ユーザー: 「CSV一括生成したPDFを検証してください」

Claude: (複数ページを順番に検証)
✅ ページ1の検証結果: OK
✅ ページ2の検証結果: OK
✅ ページ3の検証結果: OK
```

### 例3: エラー時の情報提供

```
ユーザー: 「出力されたPDFを確認してください」

Claude: (エラーを検出)
❌ 問題が見つかりました

【問題1】フォントが埋め込まれていない
- 影響: 他の環境でフォントが表示されない可能性あり
- 修正案: ReportLabの設定で `embedFont=True` を指定

【問題2】ページサイズが異なる
- 期待値: 210mm × 297mm (A4)
- 実際: 612pt × 792pt (Letter)
- 修正案: pagesize パラメータを確認
```

## 依存関係

このSkillが動作するには、以下のライブラリが必要です：

- **PyPDF2**: PDF構造解析用
- **pdfplumber**: テキスト抽出・レイアウト解析用

これらは `pyproject.toml` の `dev` 依存関係に含まれています。

```bash
# 依存関係のインストール
uv sync --all-extras
```

## トラブルシューティング

### PDFが見つからないエラー
- `output/` ディレクトリが存在するか確認
- PDFファイルが正しく生成されているか確認
- ファイルパスが正しいか確認

### テキスト抽出が失敗する
- PDFが破損していないか確認
- PDFのテキスト抽出可能な形式か確認
- ReportLabのバージョンが4.0以上か確認

### フォント情報が取得できない
- pdfplumberが最新バージョンか確認
- PyPDF2が最新バージョンか確認

## 制限事項

- **視覚的な検証**: このSkillは内容ベースの検証のみです。実際の見た目確認は目視が必要です
- **画像要素**: 郵便番号ボックスなどの画像要素は検証できない場合があります
- **フォント埋め込み**: 環境によってフォント埋め込み状態が異なる場合があります
- **複雑なレイアウト**: 複雑なレイアウトの位置検証は精度が低い場合があります

## 参考資料

- [PyPDF2 Documentation](https://pypdf2.readthedocs.io/)
- [pdfplumber GitHub](https://github.com/jsvine/pdfplumber)
- [ReportLab User Guide](https://www.reportlab.com/docs/reportlab-userguide.pdf)
- [レターパック - 日本郵便](https://www.post.japanpost.jp/)

## 今後の改善予定

- [ ] 画像要素（郵便番号ボックス）の検証
- [ ] QRコードの検証
- [ ] より詳細なレイアウト検証
- [ ] 自動修正提案の強化
- [ ] 検証レポートのCSV/JSON出力
