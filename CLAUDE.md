# Claude Code Guide

このドキュメントは、Claude Codeでこのプロジェクトを扱う際の専用ガイドです。

共通のAIエージェント向けガイドラインは [AGENTS.md](./AGENTS.md) を参照してください。

## Claude Code固有の設定

### プロジェクトのセットアップ

Claude Codeでこのプロジェクトに初めて取り組む際は、以下の手順を実行してください：

```bash
# 依存関係のインストール（開発用含む）
uv sync --all-extras

# 動作確認
uv run pytest
```

### 推奨ワークフロー

1. **変更前の確認**
   - 関連するファイルを読んで現在の実装を理解
   - 既存のテストを確認

2. **実装**
   - コードの変更を行う
   - 必要に応じてテストを追加・更新

3. **検証**
   - Ruffでコードチェック: `uv run ruff check --fix src tests`
   - フォーマット: `uv run ruff format src tests`
   - テスト実行: `uv run pytest`

4. **コミット**
   - 明確なコミットメッセージで変更をコミット
   - 複数の関連する変更は1つのコミットにまとめる

## Claude Codeの得意な作業

### 推奨タスク
- ✅ バグ修正
- ✅ 新機能の実装
- ✅ テストの追加
- ✅ ドキュメントの更新
- ✅ リファクタリング
- ✅ コードレビュー

### 注意が必要なタスク
- ⚠️ PDF生成ロジックの大幅な変更（実際のレターパックのフォーマットとの整合性確認が必要）
- ⚠️ 依存関係の大規模なアップグレード（動作確認が重要）

## コンテキスト管理のヒント

### 重要なファイル
プロジェクトを理解するために、まず以下のファイルを確認してください：

- `README.md` - プロジェクト概要と使い方
- `pyproject.toml` - プロジェクト設定と依存関係
- `src/letterpack/` - メインのコードベース
- `tests/` - テストコード

### 日本語の扱い
- このプロジェクトは日本語のドキュメントとコメントを使用
- Claude Codeは日本語を理解できるので、自然に日本語でコミュニケーション可能
- ユーザーとのやりとりは日本語でも英語でもOK（ユーザーの言語に合わせる）

## 具体的な作業例

### 新機能の追加

**例: 品名フィールドの追加**

1. 仕様を確認・質問
   - レターパックのどこに表示するか？
   - 入力形式は？（自由記述？選択式？）

2. 実装計画
   - データモデルの変更が必要か確認
   - CLI、Web両方に影響があるか確認

3. 実装
   ```bash
   # 関連ファイルの確認
   ls src/letterpack/

   # テストの確認
   ls tests/

   # 実装後の検証
   uv run ruff check --fix src tests
   uv run ruff format src tests
   uv run pytest
   ```

### バグ修正

1. 問題の再現
   - 可能であればテストケースを作成

2. 原因の特定
   - 関連コードを読む
   - デバッグ情報を確認

3. 修正と検証
   - 修正を実装
   - テストで確認
   - リグレッションがないか確認

## ツールとコマンド

### 頻繁に使用するコマンド

```bash
# プロジェクトのルートで実行

# テスト実行
uv run pytest

# 特定のテストのみ実行
uv run pytest tests/test_specific.py

# リントチェック
uv run ruff check src tests

# 自動修正
uv run ruff check --fix src tests

# フォーマット
uv run ruff format src tests

# CLIの実行
uv run python -m letterpack.cli

# Webサーバーの起動
uv run python -m letterpack.web
```

### デバッグのヒント

- エラーメッセージを確認し、スタックトレースを追う
- 必要に応じて`print()`やロギングを使用
- テストを書いて問題を再現
- ReportLabのドキュメントを参照（PDF生成関連の問題の場合）

## プルリクエストの作成

### 重要: PRテンプレートに必ず従うこと

このプロジェクトには `.github/PULL_REQUEST_TEMPLATE.md` があります。Claude CodeでPRを作成する際は、**必ずこのテンプレートの構造に従った説明文を作成してください**。

### PRテンプレートの構造

```markdown
## 概要
<!-- 変更の概要を簡潔に -->

## 変更内容
<!-- 具体的な変更内容を箇条書き -->
-
-

## 変更の理由
<!-- 背景や目的 -->

## 影響範囲
- [ ] CLI
- [ ] Web UI
- [ ] PDF生成ロジック
- [ ] テスト
- [ ] ドキュメント
- [ ] その他:

## テスト
- [ ] 既存のテストが通ることを確認
- [ ] 新しいテストを追加
- [ ] 手動でテストを実施

### テスト方法
```bash
uv run pytest
```

## チェックリスト
- [ ] コードをRuffでフォーマットした
- [ ] Ruffのリントチェックをパスした
- [ ] テストが通ることを確認した
- [ ] 必要に応じてドキュメントを更新した
- [ ] コミットメッセージが明確である

## 関連Issue
Closes #

## その他
<!-- レビュアーに伝えたいこと -->
```

### PR作成時の手順

1. **コミット履歴を確認**
   ```bash
   git log --oneline origin/main..HEAD
   git diff origin/main...HEAD
   ```

2. **テンプレートの各セクションを埋める**
   - 全てのコミットを分析して変更内容を網羅的に記載
   - チェックボックスは適切にチェックする（`[x]`）
   - 影響範囲を正確に把握する

3. **ghコマンドでPR作成**
   ```bash
   gh pr create --title "タイトル" --body "$(cat <<'EOF'
   ## 概要
   [ここに概要を記載]

   ## 変更内容
   - [変更1]
   - [変更2]

   ... 以下テンプレートに従って記載 ...
   EOF
   )"
   ```

4. **日本語で記載すること**
   - このプロジェクトは日本語が主言語です
   - PR説明文は日本語で記載してください

### PR作成の例

```bash
gh pr create --title "feat: 新しいフィールドを追加" --body "$(cat <<'EOF'
## 概要
レターパックラベルに品名フィールドを追加しました。

## 変更内容
- PDF生成ロジックに品名フィールドを追加
- CLIとWeb UIに入力欄を追加
- 品名フィールドのテストを追加

## 変更の理由
ユーザーから品名を記載したいという要望があったため。

## 影響範囲
- [x] CLI
- [x] Web UI
- [x] PDF生成ロジック
- [x] テスト
- [ ] ドキュメント
- [ ] その他:

## テスト
- [x] 既存のテストが通ることを確認
- [x] 新しいテストを追加
- [ ] 手動でテストを実施

### テスト方法
```bash
uv run pytest
```

## チェックリスト
- [x] コードをRuffでフォーマットした
- [x] Ruffのリントチェックをパスした
- [x] テストが通ることを確認した
- [ ] 必要に応じてドキュメントを更新した
- [x] コミットメッセージが明確である

## 関連Issue
Closes #123

## その他
品名フィールドは任意入力としています。
EOF
)"
```

## Claude Codeの制限事項

### できないこと
- 実際にブラウザでWebインターフェースを開いて動作確認
- 生成されたPDFを視覚的に確認（ファイルの生成は可能）
- 実際のレターパックとのサイズ比較

### 対処方法
- PDFの検証はユーザーに依頼
- テストで基本的な動作を確認
- 不明点はユーザーに質問

## コミュニケーション

### ユーザーとのやりとり
- 不明点は積極的に質問
- 実装前に確認が必要な場合は提案を示す
- 完了後は変更内容を簡潔に説明

### コードレビュー時
- 改善の余地がある箇所を指摘
- 代替案があれば提案
- ベストプラクティスを共有

## まとめ

Claude Codeでこのプロジェクトに取り組む際は：

1. **AGENTS.md**で共通のガイドラインを確認
2. **このファイル**でClaude Code固有の設定を確認
3. **README.md**でプロジェクトの使い方を理解
4. **pyproject.toml**で依存関係と設定を確認
5. 実装前に必要なファイルを読む
6. 変更後は必ずテストとリントを実行
7. **PR作成時は必ず `.github/PULL_REQUEST_TEMPLATE.md` に従う**
8. 不明点はユーザーに質問

Happy coding! 🚀
